2018/08/29

[TOC]

### 重拾flaskbb

- [x] 使用现成的包安装
- [x] 搭建项目结构，基本的安装
- [x] 安装命令的实现（click）
- [x] 首页实现
- [x] 使用蓝图
- [x] 使用数据库
- [x] 数据库迁移
- [ ] ......
- [ ] 使用正式的服务器

### 安装默认组和用户

多对多关系，一对多关系还是没有弄清白

不明白这个groups_users.c.user_id 中间的c是什么东西？

```python
secondary_groups = db.relationship(
                        'Group',
                        secondary=groups_users,
                        primaryjoin=(groups_users.c.user_id == id),
                        backref=db.backref('users', lazy='dynamic'),
                        lazy='dynamic')
```



下面这种情况一个model中同时定义了外键和relationship

```python
primary_group_id = db.Column(db.Integer, db.ForeignKey('groups.id'),
                             nullable=False)
primary_group = db.relationship('Group', lazy="joined",
                                    backref="user_group", uselist=False,
                                    foreign_keys=[primary_group_id])
```


```python
(sqlite3.OperationalError) Cannot add a NOT NULL column with default value NULL [SQL: 'ALTER TABLE users ADD COLUMN primary_group_id INTEGER NOT NULL'] 
```

这个我直接删除了migrations中versions目录下面的迁移文件重新lucheng db migrate -m "xxx"即可

    group = Group.query.filter(name=groupname)
    TypeError: filter() got an unexpected keyword argument 'name'
修改成

group = Group.query.filter(getattr(Group, groupname) == True).first()



```
TypeError: 'password' is an invalid keyword argument for User
```



想验证一个问题，表究竟是什么时候创建的？是upgrade的时候？

是的，只要你运行lucheng db migrate 生成了迁移文件，执行upgrade的时候，就会根据迁移文件升级。

